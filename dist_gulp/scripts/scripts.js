"use strict";angular.module("beerPongTournamentApp",["ngRoute","LocalStorageModule"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/selectTournament",{templateUrl:"views/selecttournament.html",controller:"SelectTournamentCtrl"}).when("/teamNaming",{templateUrl:"views/teamnaming.html",controller:"TeamNamingCtrl"}).when("/groups",{templateUrl:"views/groups.html",controller:"GroupsCtrl"}).when("/playoffs/:round",{templateUrl:"views/playoffs.html",controller:"PlayoffsCtrl"}).when("/tables/:showButton",{templateUrl:"views/tables.html",controller:"TablesCtrl"}).when("/winner",{templateUrl:"views/winner.html",controller:"WinnerCtrl"}).otherwise({redirectTo:"/"})}]);
"use strict";angular.module("beerPongTournamentApp").controller("HomeCtrl",function(){});
"use strict";angular.module("beerPongTournamentApp").controller("SelectTournamentCtrl",["$scope","$location","GroupEngine","Tournament","constants",function(e,r,n,o,a){var t;e.callAlgo=function(r){t=r,e.showPlayoffs=!1;var o=n.getGroupFromNumberOfPlayers(r);e.groupsSelect=[];for(var s=0,u=o.length;u>s;s++)for(var f=0,i=o[s].configurations.length;i>f;f++)if(o[s].configurations[f].directTournament)e.groupsSelect.push({separator:"team of "+o[s].numberOfPlayers,value:"Direct tournament from "+a.PLAYOFF_NAME[o[s].configurations[f].step],directTournament:1,step:o[s].configurations[f].step,playersPerTeam:o[s].numberOfPlayers,numberOfTeams:+Math.pow(2,1+o[s].configurations[f].step)});else{var p=[];1===o[s].configurations[f].nbrOfGroups&&p.push({step:-1,value:"simple championship"});for(var l=0,m=o[s].configurations[f].playOffStepMin.length;m>l;l++)p.push({step:o[s].configurations[f].playOffStepMin[l],value:a.PLAYOFF_NAME[o[s].configurations[f].playOffStepMin[l]]});e.groupsSelect.push({separator:"team of "+o[s].numberOfPlayers,playersPerTeam:o[s].numberOfPlayers,value:o[s].configurations[f].nbrOfGroups+" group(s) of "+o[s].configurations[f].nbrOfTeam+" teams",playOffStepMin:o[s].configurations[f].playOffStepMin,playoffs:p,nbrOfGroups:o[s].configurations[f].nbrOfGroups,numberOfTeams:o[s].configurations[f].nbrOfTeam})}},e.goNextStep=function(e,n,a){console.log("goNextStep",e,n,a),o.clearSettings();var s={numberOfPlayers:t,numberOfGroups:e.nbrOfGroups,numberOfTeamsPerGroup:e.numberOfTeams,numberOfPlayerPerTeam:e.playersPerTeam,playoffStepAfterGroup:n?n.step:void 0,isDirectTournament:e.directTournament,directTournamentStep:e.step,numberOfCupsToWin:a};o.init(s),r.path("/teamNaming")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("TeamNamingCtrl",["$scope","$location","Tournament",function(e,r,a){var s,o=a.getNumberOfGroups(),m=a.getNumberOfTeamsPerGroup(),t=a.getNumberOfPlayerPerTeam(),n=a.isADirectTournament(),u=[],p=1,l=1;if(n){s={name:"Direct Tournament",teams:[]};for(var f=0;m>f;f++){s.teams.push({name:"Team "+p++,players:[]});for(var g=0;t>g;g++)s.teams[f].players.push({name:"Player "+l++})}u.push(s),e.groups=u}else for(var T=0,i=o;i>T;T++){s={name:"GROUP "+String.fromCharCode(65+T),teams:[]};for(var c=0,h=m;h>c;c++){s.teams.push({name:"Team "+p++,players:[]});for(var y=0,P=t;P>y;y++)s.teams[c].players.push({name:"Player "+l++})}u.push(s),e.groups=u}console.log("groups",u),e.startTournament=function(){a.setTeams(e.groups),r.path(n?"/playoffs/0":"/groups")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("PlayoffsCtrl",["$scope","$location","$routeParams","Tournament","constants",function(e,t,r,s,n){var o=s.getPlayoffs(),a=s.getNumberOfCupsToWin(),l=r.round,c=Math.log(o[l].teams.length)/Math.log(2)-1,u=o[l].teams.length/2;if(e.nbrOfCupsToWin=a,e.title=n.PLAYOFF_NAME[c],o[l].result){e.games=o[l].result;for(var h=0,f=o[l].result.length;f>h;h++)(o[l].result[h].score[0]===a||o[l].result[h].match[1]===a)&&u--;0===u&&(e.showNextStep=!0)}else{for(var i=o[l].teams,m=[],g=0,p=u;p>g;g++){var w,M,v,P;w=Math.floor(Math.random()*i.length),v=i[w],i.splice(w,1),M=Math.floor(Math.random()*i.length),P=i[M],i.splice(M,1),m.push({title:v.name+" vs "+P.name,match:[v,P],score:[0,0],scorers:[[],[]],winner:-1})}e.games=m}e.setWinner=function(t,r){-1===t.winner&&(u--,0===u&&(e.showNextStep=!0)),t.winner=r},e.scoreUp=function(e,t,r){t[r]<a&&(t[r]=t[r]+1,e.score=e.score?e.score+1:1)},e.scoreDown=function(e,t,r,s){e.score>0&&(s.winner===r&&(s.winner=-1,u++),t[r]=t[r]-1,e.score=e.score-1)},e.goNextStep=function(){o[l].result=e.games;for(var r=[],n=parseInt(l)+1,c=0,u=o[l].result.length;u>c;c++)r.push(o[l].result[c].score[0]===a?o[l].result[c].match[0]:o[l].result[c].match[1]);o.push({teams:r}),s.setPlayoffs(o),t.path(r.length>1?"/playoffs/"+n:"/winner")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("GroupsCtrl",["$scope","$location","Tournament",function(r,e,o){function s(r,e,o){for(var s=0,t=r.length;t>s;s++)r[s]=s===e[0]||s===e[1]?0:r[s]+1;for(var n=0,u=o.length;u>n;n++)o[n].priority=r[o[n].match[0]]+r[o[n].match[1]];o.sort(function(r,e){return e.priority-r.priority})}var t=o.getNumberOfCupsToWin(),n=0;if(r.nbrOfCupsToWin=t,r.showNextStep=!1,o.getGroupsResult()){var u=o.getGroupsResult();r.groups=u;for(var p=0,a=u.length;a>p;p++)for(var l=0,c=u[p].rounds.length;c>l;l++)for(var h=0,i=u[p].rounds[l].length;i>h;h++)u[p].rounds[l][h].winner<0&&n++;0===n&&(r.showNextStep=!0)}else{for(var g=[],f=o.getTeams(),v=0,m=f.length;m>v;v++){for(var y=f[v],w=f[v].teams,G=w.length,d=[],R=[],N=0,T=w.length;T>N;N++)R.push(0);for(var b=1,x=w.length;x>b;b++)for(var S=0;b-1>=S;S++){for(var C=[],W=[],O=0,$=w[b].players.length;$>O;O++)w[b].players[O].score=0,C.push(angular.copy(w[b].players[O])),w[S].players[O].score=0,W.push(angular.copy(w[S].players[O]));console.log("team1",C,"team2",W),d.push({priority:0,match:[b,S],title:w[b].name+" vs "+w[S].name,score:[0,0],scorers:[C,W],winner:-1})}for(n+=d.length,y.rounds=[];d.length>0;){for(var A=[],D=0,M=Math.floor(G/2);M>D;D++){var P=d.shift();A.push(P),s(R,P.match,d)}y.rounds.push(A)}g.push(y)}r.groups=g,o.setGroupsResult(r.groups)}r.setWinner=function(e,o){-1===e.winner&&(n--,0===n&&(r.showNextStep=!0)),e.winner=o},r.scoreUp=function(e,s,n){s[n]<t&&(s[n]=s[n]+1,e.score=e.score?e.score+1:1,o.setGroupsResult(r.groups))},r.scoreDown=function(e,s,t,u){e.score>0&&(u.winner===t&&(u.winner=-1,n++),s[t]=s[t]-1,e.score=e.score-1,o.setGroupsResult(r.groups))},r.goNextStep=function(){o.setGroupsResult(r.groups),e.path("/tables/1")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("TablesCtrl",["$scope","$routeParams","$location","Tournament",function(e,o,t,a){var r=a.getPlayoffStepAfterGroup(),n=a.getTables(),l=a.getTeams();if(e.showButton=o.showButton,console.log("hide button",e.hideButton),e.tables=n,r>-1){var s=a.getNumberOfGroups(),u=Math.pow(2,r+1)/s;e.numberOfTeamsQualifiedPerGroups=u;var f=[],i=angular.copy(l);console.log("teams",l,n);for(var m=0;m<l.length;m++)for(var p=0;u>p;p++)for(var g=i[m].teams.length;g--;)if(i[m].teams[g].name===n[m].table[p].name){f.push(i[m].teams[g]);break}a.SetTeamsQualifiedForPlayoff(f),console.log("teamsQualified",f),e.goNextStep=function(){t.path("/playoffs/0")}}else e.goNextStep=function(){t.path("/winner")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("WinnerCtrl",["$scope","Tournament",function(n,e){var o=e.getPlayoffs(),r=o.pop().teams[0];console.log("winner",o,r),n.winner=r}]);
"use strict";angular.module("beerPongTournamentApp").controller("HeaderCtrl",["$scope","$location","Tournament","localStorageService",function(e,t,o,n){var a=t.url(),r=n.get("tournamentPath");e.isOpen=!1,"/tables/0"===a?(e.tablesView=!0,e.scorersView=!1,e.tournamentView=!1):"/scorers"===a?(e.scorersView=!0,e.tablesView=!1,e.tournamentView=!1):(n.set("tournamentPath",a),r=a,e.tournamentView=!0,e.tablesView=!1,e.scorersView=!1),e.displayTablesButton=o.getTables(),e.goBackToTournament=function(){console.log("go back tournament",r),t.path(r)},e.goTables=function(){console.log("go tables",r),t.path("/tables/0")},e.toggleMenu=function(){e.isOpen=!e.isOpen}}]);
"use strict";angular.module("beerPongTournamentApp").factory("GroupEngine",function(){function r(r){var a=Math.log(r)/Math.log(2);return a===parseInt(a)}function a(a){var o=[];r(a)&&o.push({directTournament:1,step:Math.log(a/2)/Math.log(2)});for(var t=!0,n=0;t;){var u=a/Math.pow(2,n);if(u===parseInt(u)&&u>2){for(var e=Math.pow(2,n),f=a-e,h=Math.floor(Math.log(f)/Math.log(2)),i=Math.pow(2,h),p=!0,s=0,g=[];p;)3>e&&2*Math.pow(2,s)<=i?(g.push(Math.log(Math.pow(2,s))/Math.log(2)),s++):e>2&&e*Math.pow(2,s)<=i?(g.push(Math.log(e*Math.pow(2,s)/2)/Math.log(2)),s++):p=!1;o.push({nbrOfGroups:e,nbrOfTeam:u,playOffStepMin:g}),n++}else t=!1}return o}var o={};return o.getGroupFromNumberOfPlayers=function(r){var o=[];if(r>1){var t={numberOfPlayers:1,configurations:[]};t.configurations=a(r),o.push(t)}if(r%2===0&&r>4){var n={numberOfPlayers:2,configurations:[]};n.configurations=a(r/2),o.push(n)}if(r%3===0&&r>6){var u={numberOfPlayers:3,configurations:[]};u.configurations=a(r/3),o.push(u)}return o},o});
"use strict";angular.module("beerPongTournamentApp").service("Tournament",["localStorageService",function(e){function t(e,t,n,r,s){for(var o=e.length;o--;)if(e[o].name===t){"win"===n?e[o].win+=1:"lose"===n&&(e[o].lose+=1),e[o].cupsFor+=r,e[o].cupsAgainst+=s;break}}var n=e.get("tournamentSettings")||{},r=e.get("teams")||{},s=e.get("groupResult")||!1,o=e.get("playoffs")||!1;this.clearSettings=function(){e.remove("tournamentSettings"),e.remove("teams"),e.remove("groupResult"),e.remove("playoffs"),n=r=s=o=!1},this.init=function(t){e.set("tournamentSettings",t),console.log(t),n=t,console.log("sam",t)},this.isADirectTournament=function(){return n.isDirectTournament},this.getNumberOfGroups=function(){return n.numberOfGroups},this.getDirectTournamentStep=function(){return n.directTournamentStep},this.getNumberOfTeamsPerGroup=function(){return n.numberOfTeamsPerGroup},this.getNumberOfPlayerPerTeam=function(){return n.numberOfPlayerPerTeam},this.setTeams=function(t){console.log("setTeams",t),r=t,e.set("teams",t)},this.getTeams=function(){return console.log("getTeams",r),r},this.SetTeamsQualifiedForPlayoff=function(t){o=[{teams:t}],e.set("playoffs",o)},this.setPlayoffs=function(t){e.set("playoffs",t),o=t},this.getPlayoffs=function(){return o?o:[{teams:r[0].teams}]},this.getNumberOfCupsToWin=function(){return n.numberOfCupsToWin},this.getPlayoffStepAfterGroup=function(){return n.playoffStepAfterGroup},this.getGroupsResult=function(){return s},this.setGroupsResult=function(t){e.set("groupResult",t),s=t},this.getTables=function(){var e=[];console.log("getTables",s);for(var n=0,r=s.length;r>n;n++){for(var o={name:s[n].name,table:[]},u=0,a=s[n].teams.length;a>u;u++){var i={name:s[n].teams[u].name,win:0,lose:0,cupsFor:0,cupsAgainst:0};o.table.push(i)}for(var f=0,m=s[n].rounds.length;m>f;f++)for(var l=0,c=s[n].rounds[f].length;c>l;l++){var g=s[n].rounds[f][l];if(g.winner>-1){var p=g.winner,h=+!g.winner;t(o.table,s[n].teams[g.match[p]].name,"win",g.score[p],g.score[h]),t(o.table,s[n].teams[g.match[h]].name,"lose",g.score[h],g.score[p])}}o.table.sort(function(e,t){return t.win-e.win}),e.push(o)}return e}}]);
"use strict";angular.module("beerPongTournamentApp").constant("constants",{PLAYOFF_NAME:["final","semi-final","quarter-final","16nd round","32nd round","64nd round"]});