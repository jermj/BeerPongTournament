"use strict";angular.module("beerPongTournamentApp",["ngRoute","LocalStorageModule"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/selectTournament",{templateUrl:"views/selecttournament.html",controller:"SelectTournamentCtrl"}).when("/teamNaming",{templateUrl:"views/teamnaming.html",controller:"TeamNamingCtrl"}).when("/groups",{templateUrl:"views/groups.html",controller:"GroupsCtrl"}).when("/playoffs/:round",{templateUrl:"views/playoffs.html",controller:"PlayoffsCtrl"}).when("/tables/:showButton",{templateUrl:"views/tables.html",controller:"TablesCtrl"}).when("/winner",{templateUrl:"views/winner.html",controller:"WinnerCtrl"}).when("/scorers",{templateUrl:"views/scorers.html",controller:"ScorersCtrl"}).otherwise({redirectTo:"/"})}]);
"use strict";angular.module("beerPongTournamentApp").controller("HomeCtrl",["$scope","localStorageService",function(e,t){e.lastTournament=t.get("tournamentPath")}]);
"use strict";angular.module("beerPongTournamentApp").controller("SelectTournamentCtrl",["$scope","$location","GroupEngine","Tournament","constants",function(e,r,n,o,a){var t;e.callAlgo=function(r){t=r,e.showPlayoffs=!1;var o=n.getGroupFromNumberOfPlayers(r);e.groupsSelect=[];for(var s=0,u=o.length;u>s;s++)for(var f=0,i=o[s].configurations.length;i>f;f++)if(o[s].configurations[f].directTournament)e.groupsSelect.push({separator:"team of "+o[s].numberOfPlayers,value:"Direct tournament from "+a.PLAYOFF_NAME[o[s].configurations[f].step],directTournament:1,step:o[s].configurations[f].step,playersPerTeam:o[s].numberOfPlayers,numberOfTeams:+Math.pow(2,1+o[s].configurations[f].step)});else{var p=[];1===o[s].configurations[f].nbrOfGroups&&p.push({step:-1,value:"simple championship"});for(var m=0,l=o[s].configurations[f].playOffStepMin.length;l>m;m++)p.push({step:o[s].configurations[f].playOffStepMin[m],value:a.PLAYOFF_NAME[o[s].configurations[f].playOffStepMin[m]]});e.groupsSelect.push({separator:"team of "+o[s].numberOfPlayers,playersPerTeam:o[s].numberOfPlayers,value:o[s].configurations[f].nbrOfGroups+" group(s) of "+o[s].configurations[f].nbrOfTeam+" teams",playOffStepMin:o[s].configurations[f].playOffStepMin,playoffs:p,nbrOfGroups:o[s].configurations[f].nbrOfGroups,numberOfTeams:o[s].configurations[f].nbrOfTeam})}},e.goNextStep=function(e,n,a){o.clearSettings();var s={numberOfPlayers:t,numberOfGroups:e.nbrOfGroups,numberOfTeamsPerGroup:e.numberOfTeams,numberOfPlayerPerTeam:e.playersPerTeam,playoffStepAfterGroup:n?n.step:void 0,isDirectTournament:e.directTournament,directTournamentStep:e.step,numberOfCupsToWin:a};o.init(s),r.path("/teamNaming")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("TeamNamingCtrl",["$scope","$location","Tournament",function(e,r,a){var s,m=a.getNumberOfGroups(),o=a.getNumberOfTeamsPerGroup(),t=a.getNumberOfPlayerPerTeam(),n=a.isADirectTournament(),u=[],p=1,l=1;if(n){s={name:"Direct Tournament",teams:[]};for(var f=0;o>f;f++){s.teams.push({name:"Team "+p++,players:[]});for(var i=0;t>i;i++)l++,s.teams[f].players.push({name:"Player "+l,id:l})}u.push(s),e.groups=u}else for(var g=0,T=m;T>g;g++){s={name:"GROUP "+String.fromCharCode(65+g),teams:[]};for(var c=0,h=o;h>c;c++){s.teams.push({name:"Team "+p++,players:[]});for(var y=0,P=t;P>y;y++)s.teams[c].players.push({name:"Player "+l++,id:l})}u.push(s),e.groups=u}e.startTournament=function(){a.setTeams(e.groups),r.path(n?"/playoffs/0":"/groups")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("PlayoffsCtrl",["$scope","$location","$routeParams","Tournament","constants",function(e,s,r,t,o){var a=angular.copy(t.getPlayoffs()),n=t.getNumberOfCupsToWin(),l=r.round,u=a[l].teams.length,c=Math.log(u)/Math.log(2)-1,p=u/2;if(e.nbrOfCupsToWin=n,e.title=o.PLAYOFF_NAME[c],a[l].result){e.games=a[l].result;for(var f=0,g=a[l].result.length;g>f;f++){var h=a[l].result[f];h.winner>-1&&p--}0===p&&(e.showNextStep=!0)}else{for(var i=angular.copy(a[l].teams),m=[],y=0,w=p;w>y;y++){var P,v,M,d;P=Math.floor(Math.random()*i.length),M=i[P],i.splice(P,1),v=Math.floor(Math.random()*i.length),d=i[v],i.splice(v,1);for(var N=[],x=[],T=M.players.length,b=d.players.length,A=0,C=Math.max(T,b);C>A;A++)T>A&&(M.players[A].score=0,N.push(angular.copy(M.players[A]))),b>A&&(d.players[A].score=0,x.push(angular.copy(d.players[A])));m.push({title:M.name+" vs "+d.name,match:[M,d],score:[0,0],scorers:[N,x],winner:-1})}e.games=m}e.setWinner=function(s,r){-1===s.winner&&(p--,0===p&&(e.showNextStep=!0)),s.winner=r,a[l].result=e.games,t.setPlayoffs(a)},e.scoreUp=function(s,r,o){r[o]<n&&(r[o]=r[o]+1,s.score=s.score?s.score+1:1,a[l].result=e.games,t.setPlayoffs(a))},e.scoreDown=function(s,r,o,n){s.score>0&&(n.winner===o&&(n.winner=-1,p++),r[o]=r[o]-1,s.score=s.score-1,a[l].result=e.games,console.log("score down",a),t.setPlayoffs(a))},e.goNextStep=function(){a[l].result=e.games;for(var r=[],o=parseInt(l)+1,u=0,c=a[l].result.length;c>u;u++)r.push(a[l].result[u].score[0]===n?a[l].result[u].match[0]:a[l].result[u].match[1]);a.push({teams:r}),t.setPlayoffs(a),s.path(r.length>1?"/playoffs/"+o:"/winner")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("GroupsCtrl",["$scope","$location","Tournament",function(r,e,o){function s(r,e,o){for(var s=0,t=r.length;t>s;s++)r[s]=s===e[0]||s===e[1]?0:r[s]+1;for(var n=0,u=o.length;u>n;n++)o[n].priority=r[o[n].match[0]]+r[o[n].match[1]];o.sort(function(r,e){return e.priority-r.priority})}var t=o.getNumberOfCupsToWin(),n=0;if(r.nbrOfCupsToWin=t,r.showNextStep=!1,o.getGroupsResult()){var u=o.getGroupsResult();r.groups=u;for(var p=0,a=u.length;a>p;p++)for(var l=0,h=u[p].rounds.length;h>l;l++)for(var c=0,g=u[p].rounds[l].length;g>c;c++)u[p].rounds[l][c].winner<0&&n++;0===n&&(r.showNextStep=!0)}else{for(var i=[],f=o.getTeams(),v=0,m=f.length;m>v;v++){for(var y=f[v],w=f[v].teams,G=w.length,R=[],d=[],x=0,N=w.length;N>x;x++)d.push(0);for(var T=1,b=w.length;b>T;T++)for(var S=0;T-1>=S;S++){for(var C=[],W=[],M=w[T].players.length,O=w[S].players.length,l=0,h=Math.max(M,O);h>l;l++)M>l&&(w[T].players[l].score=0,C.push(angular.copy(w[T].players[l]))),O>l&&(w[S].players[l].score=0,W.push(angular.copy(w[S].players[l])));R.push({priority:0,match:[T,S],title:w[T].name+" vs "+w[S].name,score:[0,0],scorers:[C,W],winner:-1})}for(n+=R.length,y.rounds=[];R.length>0;){for(var $=[],A=0,D=Math.floor(G/2);D>A;A++){var P=R.shift();$.push(P),s(d,P.match,R)}y.rounds.push($)}i.push(y)}r.groups=i,o.setGroupsResult(r.groups)}r.setWinner=function(e,s){-1===e.winner&&(n--,0===n&&(r.showNextStep=!0)),e.winner=s,o.setGroupsResult(r.groups)},r.scoreUp=function(e,s,n){s[n]<t&&(s[n]=s[n]+1,e.score=e.score?e.score+1:1,o.setGroupsResult(r.groups))},r.scoreDown=function(e,s,t,u){e.score>0&&(u.winner===t&&(u.winner=-1,n++),s[t]=s[t]-1,e.score=e.score-1,o.setGroupsResult(r.groups))},r.goNextStep=function(){o.setGroupsResult(r.groups),e.path("/tables/1")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("TablesCtrl",["$scope","$routeParams","$location","Tournament",function(e,t,a,o){var r=o.getPlayoffStepAfterGroup(),n=o.getTables(),f=o.getTeams(),s=(o.getPlayoffs(),parseInt(t.showButton));if(e.showButton=s,e.tables=n,r>-1){var l=o.getNumberOfGroups(),u=Math.pow(2,r+1)/l;if(e.numberOfTeamsQualifiedPerGroups=u,s){for(var p=[],m=angular.copy(f),i=0;i<f.length;i++)for(var g=0;u>g;g++)for(var b=m[i].teams.length;b--;)if(m[i].teams[b].name===n[i].table[g].name){p.push(m[i].teams[b]);break}o.SetTeamsQualifiedForPlayoff(p),e.goNextStep=function(){a.path("/playoffs/0")}}}else e.goNextStep=function(){a.path("/winner")}}]);
"use strict";angular.module("beerPongTournamentApp").controller("WinnerCtrl",["$scope","Tournament",function(n,e){var r=angular.copy(e.getPlayoffs()),o=r.pop().teams[0];n.winner=o}]);
"use strict";angular.module("beerPongTournamentApp").controller("HeaderCtrl",["$scope","$location","Tournament","localStorageService",function(e,t,n,o){var a=t.url();e.goTournament=o.get("tournamentPath"),e.isOpen=!1,e.iconActive=-1,"/tables/0"===a?e.iconActive=1:"/scorers"===a?e.iconActive=2:(o.set("tournamentPath","#"+a),e.goTournament="#"+a,e.iconActive=0),e.displayTablesButton=n.getTables(),e.displayScorersButton=n.getTeams(),e.toggleMenu=function(){e.isOpen=!e.isOpen}}]);
"use strict";angular.module("beerPongTournamentApp").controller("ScorersCtrl",["$scope","Tournament",function(r,o){r.scorers=o.getScorers(),console.log("scorers",r.scorers)}]);
"use strict";angular.module("beerPongTournamentApp").factory("GroupEngine",function(){function r(r){var a=Math.log(r)/Math.log(2);return a===parseInt(a)}function a(a){var o=[];r(a)&&o.push({directTournament:1,step:Math.log(a/2)/Math.log(2)});for(var t=!0,n=0;t;){var u=a/Math.pow(2,n);if(u===parseInt(u)&&u>2){for(var e=Math.pow(2,n),f=a-e,h=Math.floor(Math.log(f)/Math.log(2)),i=Math.pow(2,h),p=!0,s=0,g=[];p;)3>e&&2*Math.pow(2,s)<=i?(g.push(Math.log(Math.pow(2,s))/Math.log(2)),s++):e>2&&e*Math.pow(2,s)<=i?(g.push(Math.log(e*Math.pow(2,s)/2)/Math.log(2)),s++):p=!1;o.push({nbrOfGroups:e,nbrOfTeam:u,playOffStepMin:g}),n++}else t=!1}return o}var o={};return o.getGroupFromNumberOfPlayers=function(r){var o=[];if(r>1){var t={numberOfPlayers:1,configurations:[]};t.configurations=a(r),o.push(t)}if(r%2===0&&r>4){var n={numberOfPlayers:2,configurations:[]};n.configurations=a(r/2),o.push(n)}if(r%3===0&&r>6){var u={numberOfPlayers:3,configurations:[]};u.configurations=a(r/3),o.push(u)}return o},o});
"use strict";angular.module("beerPongTournamentApp").service("Tournament",["localStorageService",function(e){function r(e,r,t,n,s){for(var o=e.length;o--;)if(e[o].name===r){"win"===t?e[o].win+=1:"lose"===t&&(e[o].lose+=1),e[o].cupsFor+=n,e[o].cupsAgainst+=s;break}}function t(e,r,t,n){for(var s=e.length;s--;)if(e[s].id===r){e[s].score+=t,e[s].numberOfGame+=1,console.log("win",n),e[s].win+=+n;break}}var n=e.get("tournamentSettings")||{},s=e.get("teams")||{},o=e.get("groupResult")||!1,a=e.get("playoffs")||!1;this.clearSettings=function(){e.clearAll(),n=s=o=a=!1},this.init=function(r){e.set("tournamentSettings",r),n=r},this.isADirectTournament=function(){return n.isDirectTournament},this.getNumberOfGroups=function(){return n.numberOfGroups},this.getDirectTournamentStep=function(){return n.directTournamentStep},this.getNumberOfTeamsPerGroup=function(){return n.numberOfTeamsPerGroup},this.getNumberOfPlayerPerTeam=function(){return n.numberOfPlayerPerTeam},this.setTeams=function(r){s=r,e.set("teams",r)},this.getTeams=function(){return s},this.SetTeamsQualifiedForPlayoff=function(r){a=[{teams:r}],e.set("playoffs",a)},this.setPlayoffs=function(r){e.set("playoffs",r),a=r},this.getPlayoffs=function(){return a?a:[{teams:s[0].teams}]},this.getNumberOfCupsToWin=function(){return n.numberOfCupsToWin},this.getPlayoffStepAfterGroup=function(){return n.playoffStepAfterGroup},this.getGroupsResult=function(){return o},this.setGroupsResult=function(r){e.set("groupResult",r),o=r},this.getTables=function(){for(var e=[],t=0,n=o.length;n>t;t++){for(var s={name:o[t].name,table:[]},a=0,i=o[t].teams.length;i>a;a++){var u={name:o[t].teams[a].name,win:0,lose:0,cupsFor:0,cupsAgainst:0};s.table.push(u)}for(var f=0,c=o[t].rounds.length;c>f;f++)for(var l=0,m=o[t].rounds[f].length;m>l;l++){var g=o[t].rounds[f][l];if(g.winner>-1){var h=g.winner,p=+!g.winner;r(s.table,o[t].teams[g.match[h]].name,"win",g.score[h],g.score[p]),r(s.table,o[t].teams[g.match[p]].name,"lose",g.score[p],g.score[h])}}s.table.sort(function(e,r){return r.win-e.win}),e.push(s)}return e},this.getScorers=function(){for(var e=[],r=0,n=s.length;n>r;r++)for(var i=s[r],u=s[r].name,f=0,c=i.teams.length;c>f;f++)for(var l=s[r].teams[f],m=s[r].teams[f].name,g=0,h=l.players.length;h>g;g++){var p=l.players[g];p.score=0,p.numberOfGame=0,p.groupName=u,p.teamName=m,p.win=0,e.push(p)}if(o)for(var r=0,n=o.length;n>r;r++)for(var i=o[r],f=0,c=i.rounds.length;c>f;f++)for(var v=i.rounds[f],g=0,h=v.length;h>g;g++){var b=v[g];if(b.winner>-1)for(var w=b.scorers[0].length,T=b.scorers[1].length,d=0,y=Math.max(w,T);y>d;d++){if(w>d){var P=b.scorers[0][d];t(e,P.id,P.score,0===b.winner)}if(T>d){var S=b.scorers[1][d];t(e,S.id,S.score,1===b.winner)}}}if(console.log("playoffs",a),a)for(var r=0,n=a.length;n>r;r++){var G=a[r];if(G.result)for(var f=0,c=G.result.length;c>f;f++){var b=G.result[f];if(b.winner>-1)for(var w=b.scorers[0].length,T=b.scorers[1].length,d=0,y=Math.max(w,T);y>d;d++){if(w>d){var P=b.scorers[0][d];t(e,P.id,P.score,0===b.winner)}if(T>d){var S=b.scorers[1][d];t(e,S.id,S.score,1===b.winner)}}}}return e.sort(function(e,r){return r.score-e.score}),e}}]);
"use strict";angular.module("beerPongTournamentApp").constant("constants",{PLAYOFF_NAME:["final","semi-final","quarter-final","16nd round","32nd round","64nd round"]});